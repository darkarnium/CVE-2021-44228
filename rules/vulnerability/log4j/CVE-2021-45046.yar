/**
 * Attempts to detect log4j versions which are vulnerable to CVE-2021-45046 by looking
 * for the Interpolator classes which lack changes introduced in 2.16.0.
 */
rule VulnerabilityLog4jCVE202145046 : Vulerability log4j CVE {

    meta:
        name        = "CVE-2021-45046"
        author      = "Peter Adkins"
        version     = "0.1.0"
        accuracy    = 80
        description = "log4j (< 2.16.0) potentially vulnerable to CVE-2021-45046"

    strings:
        $LookupError = "Unable to create Lookup for " ascii wide
        $ServletCtx = "ServletContext" ascii wide
        $PrefixSep = "PREFIX_SEPARATOR" ascii wide
        $JndiManager = "-org/apache/logging/log4j/core/net/JndiManager" ascii wide

    condition:
        ($LookupError and $ServletCtx and $PrefixSep) and not $JndiManager
}
