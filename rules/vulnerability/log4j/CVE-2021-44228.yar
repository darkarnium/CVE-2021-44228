/**
 * Attempts to detect log4j versions which are vulnerable to CVE-2021-44228 by looking
 * for the signature of JndiManager prior to 2.15.0.
 */
rule VulnerabilityLog4jCVE202144228 : Vulerability log4j CVE {

    meta:
        name        = "CVE-2021-44228"
        author      = "Peter Adkins"
        version     = "0.1.0"
        accuracy    = 80
        description = "log4j (<= 2.15.0) potentially vulnerable to CVE-2021-44228"

    strings:
        $JndiManagerFactory = "JndiManagerFactory" ascii wide
        $JndiManagerInit = {
            3c 69 6e 69 74 3e ?? ?? ?? 28 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69
            6e 67 3b 4c 6a 61 76 61 78 2f 6e 61 6d 69 6e 67 2f 43 6f 6e 74 65 78 74 3b
            29 56
        }

    condition:
        $JndiManagerFactory and $JndiManagerInit
}
