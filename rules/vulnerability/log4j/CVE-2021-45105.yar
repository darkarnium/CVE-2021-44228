/**
 * Attempts to detect log4j versions which are vulnerable to CVE-2021-45105 by looking
 * for the AbstractBuilder class which lack changes introduced in 2.17.0.
 */
rule VulnerabilityLog4jCVE202145105 : Vulerability log4j CVE {

    meta:
        name        = "CVE-2021-45105"
        author      = "Peter Adkins"
        version     = "0.1.0"
        accuracy    = 80
        description = "log4j (< 2.17.0) potentially vulnerable to CVE-2021-45105"

    strings:
        $BufferSize = "BUF_SIZE" ascii wide
        $UnableToInit = "Unable to initialize {} due to {}" ascii wide
        $StartedConfig = "Started configuration {} OK" ascii wide
        $ConfigurationStrSubstitutor = "org/apache/logging/log4j/core/lookup/ConfigurationStrSubstitutor" ascii wide

    condition:
        ($BufferSize and $UnableToInit and $StartedConfig) and not $ConfigurationStrSubstitutor
}
