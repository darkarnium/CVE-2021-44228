#!/bin/bash

set -uo pipefail

# Ensure Docker.
if [ "x$(which docker)" == "x" ]; then
    echo "ERROR: Unable to find docker, exiting. Please install 'docker' to continue."
    exit 1
fi

# Ensure jq.
if [ "x$(which jq)" == "x" ]; then
    echo "ERROR: Unable to find jq, exiting. Please install 'jq' to continue."
    exit 1
fi

# Run it.
docker run \
    --rm \
    --mount "type=bind,source=$(pwd)/artifacts,target=/mnt/stacs/input" \
    --mount "type=bind,source=$(pwd)/rules,target=/mnt/stacs/rules" \
    stacscan/stacs:latest \
      --rule-pack "/mnt/stacs/rules/vulnerability.json" \
      "/mnt/stacs/input" | jq .runs[0].results[]
