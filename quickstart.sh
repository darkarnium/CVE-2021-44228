#!/bin/bash

set -uo pipefail

# Ensure Docker.
DOCKER_PATH=$(which docker)

if [ $? -ne 0 ]; then
    echo "ERROR: Unable to find docker, cannot continue."
fi

# Ensure jq.
DOCKER_PATH=$(which jq)

if [ $? -ne 0 ]; then
    echo "ERROR: Unable to find jq, cannot continue."
fi

# Run it.
docker run \
    --rm \
    --mount "type=bind,source=$(pwd)/artifacts,target=/mnt/stacs/input" \
    --mount "type=bind,source=$(pwd)/rules,target=/mnt/stacs/rules" \
    stacs:latest \
      --rule-pack "/mnt/stacs/rules/vulnerability.json" \
      "/mnt/stacs/input" | jq .runs[0].results[]
